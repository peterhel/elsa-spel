<!DOCTYPE html>
<html>
    <head>
        <style>
            body {
                margin: 0;
            }
        </style>
    </head>
    <body>
        
    </body>
    <script>

        let movements = []

        let moves = {
            jump: [[0, -15],[0,-15],[0,-10],[0,-5],[0,0],[0,5],[0,10],[0,15],[0,15]],
            up: [[0, -10], [0, -10], [0, -5]],
            down:[[0, 10], [0, 10], [0, 5]],
            left: [[-10,0], [-10,0], [-5,0]],
            right:[[10,0], [10,0], [5,0]],
        }

        let elsaPos = [0, 0];

        const canvas = document.createElement("canvas");
        canvas.width = document.documentElement.clientWidth*.8;
        canvas.height = document.documentElement.clientHeight*.8;

        var ctx = canvas.getContext("2d");

        ctx.font = "20px Georgia";
        ctx.fillText("Hello World!", 10, 50);

        let renderActions = [
            renderFPS,
        ]

        function renderElsa() {
            let movementChange = movements.shift();
            if(movementChange) {
                elsaPos[0] += movementChange[0]
                elsaPos[1] += movementChange[1]
            }

            ctx.drawImage(this, elsaPos[0],elsaPos[1]);
        }


        drawing = new Image();
        drawing.src = "res/elsa.png"; // can also be a remote URL e.g. http://
        drawing.onload = function() {
            renderElsa = renderElsa.bind(drawing)
            renderActions.unshift(renderElsa);
        };

        document.body.appendChild(canvas);

        let lastFrame = performance.now()

        let framelag = 0;
        let framesRendered = 0;

        function renderFPS() {
            framesRendered++

            let thisFrame = performance.now();
            if(framelag === 0) {
                framelag = thisFrame - lastFrame
            } else {
                framelag = (framelag + (thisFrame - lastFrame)) / 2;
            }
            let framesPerSec = Math.round(1000/framelag);

            lastFrame = performance.now()

            ctx.fillText(framesPerSec, 10, 50);
        }

        function loop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for(let action of renderActions) {
                action()
            }

            window.requestAnimationFrame(loop);
        }

        window.requestAnimationFrame(loop);

        let stepLength = 5;

        window.addEventListener('keydown', e => {
            if(movements.length > 0) {
                return;
            }
            switch(e.code) {
                case 'ArrowDown':
                    movements = [...moves.down]
                    break;
                case 'ArrowUp':
                    movements = [...moves.up]
                    break;
                case 'ArrowRight':
                    movements = [...moves.right]
                    break;
                case 'ArrowLeft':
                    movements = [...moves.left]
                    break;
                case 'Space':
                    movements = [...moves.jump]
                default:
                    console.log(e.code)
            }
        })
    </script>
</html>